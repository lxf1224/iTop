<?xml version="1.0" encoding="UTF-8"?>
<itop_design xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.7">
	<portals>
		<portal id="itop-portal" _delta="define"><!-- ID must match module_design[id] -->
			<url>pages/exec.php?exec_module=itop-portal-base&amp;exec_page=index.php&amp;portal_id=itop-portal</url><!-- portal_id must match module_design[id] -->
			<rank>1.0</rank>
			<handler />
			<allow>
			</allow>
			<deny />
		</portal>
	</portals>
	<module_designs>
		<module_design id="itop-portal" xsi:type="portal" _delta="define">
			<properties>
				<name>portal:itop-portal</name>
				<!-- Can be either a fileref or a relative path to the file (To be tested). Takes over env-xxx/branding/portal-logo.png -->
				<!--<fileref ref="brt_6a2be154b2a62659d3332c513bdad715"  />-->
				<!--<logo>../images/itop-logo.png</logo>-->
				<!-- Can be either a fileref or a relative path to the file from /env-xxx (eg. itop-portal-base/mystyle.css) -->
				<!-- Available themes must have a unique id. Some ids are loaded in a specific order : bootstrap/portal/custom. Other ids are loaded after them, but their order cannot be predicted -->
				<themes/>
				<!-- Can be either a fileref or a relative path to the file from /env-xxx (eg. itop-portal-base/mytemplate.html.twig) -->
				<!-- Available templates are id="layout|home" -->
				<templates/>
				<urlmaker_class>iTopPortalViewUrlMaker</urlmaker_class>
				<!-- An OQL query to determine which TriggerOnPortalUpdate to use within THIS instance of the portal. This is mostly needed to enable different triggers on several portal instances -->
				<!-- Note : ":parent_classes" parameter is a reserved name that will be used for the current object class name (and its ancestors) -->
				<triggers_query><![CDATA[SELECT TriggerOnPortalUpdate AS t WHERE t.target_class IN (:parent_classes)]]></triggers_query>
				<attachments>
					<allow_delete>true</allow_delete>
				</attachments>
			</properties>
			<bricks>
				<brick id="user-profile" xsi:type="Combodo\iTop\Portal\Brick\UserProfileBrick">
					<rank>
						<default>1</default>
					</rank>
					<title>
						<default>Brick:Portal:UserProfile:Navigation:Dropdown:MyProfil</default>
					</title>
					<decoration_class>
						<default>fa fa-user fa-2x</default>
					</decoration_class>
					<form>
						<!-- Optionnal tag to list the fields. If empty only fields from <twig> tag will be displayed, if ommited fields from zlist details will. -->
						<fields/>
						<!-- Optionnal tag to specify the form layout. Fields that are not positionned in the layout will be placed at the end of the form -->
						<twig>
							<!-- data-field-id attribute must be an attribute code of the class -->
							<!-- data-field-flags attribute contains flags among read_only/hidden/mandatory/must_prompt/must_change -->
							<div class="form_field" data-field-id="first_name" data-field-flags="read_only">
							</div>
							<div class="form_field" data-field-id="name" data-field-flags="read_only">
							</div>
							<div class="form_field" data-field-id="org_id" data-field-flags="read_only">
							</div>
							<div class="form_field" data-field-id="email" data-field-flags="read_only">
							</div>
							<div class="form_field" data-field-id="phone">
							</div>
							<div class="form_field" data-field-id="function">
							</div>
							<div class="form_field" data-field-id="manager_id" data-field-flags="read_only">
							</div>
						</twig>
					</form>
				</brick>
			</bricks>
			<classes>
				<!-- Note : A class (or one of its ancestors) MUST be declared here to be displayed in the portal -->
				<class id="User">
					<!-- Allow <allowed_profile>s to apply the <transition>s below. Flags on <field>s will be merged with those from datamodel -->
					<!-- See example in UserRequest class -->
					<!--<lifecycle/>-->
					<scopes>
						<!-- Note : Silos apply to those scope queries -->
						<scope id="all">
							<oql_view><![CDATA[SELECT User AS U JOIN Person AS P ON U.contactid=P.id WHERE P.id = :current_contact_id]]></oql_view>
							<!-- No object of this class can be edited -->
							<!--<oql_edit />-->
							<!-- Everybody -->
							<!--<allowed_profiles />-->
						</scope>
					</scopes>
				</class>
				<class id="Organization">
					<scopes>
						<scope id="all">
							<oql_view><![CDATA[SELECT Organization WHERE id = :current_contact->org_id]]></oql_view>
						</scope>
					</scopes>
				</class>
				<class id="Person">
					<scopes>
						<scope id="all">
							<oql_view><![CDATA[SELECT Person AS p JOIN lnkPersonToTeam AS l2 ON l2.person_id = p.id JOIN Team AS t ON l2.team_id=t.id]]></oql_view>
						</scope>
						<scope id="current-person">
							<oql_view><![CDATA[SELECT Person AS p WHERE id = :current_contact_id]]></oql_view>
						</scope>
					</scopes>
				</class>
				<class id="Contact">
					<scopes>
						<scope id="all">
							<oql_view><![CDATA[SELECT Contact WHERE org_id = :current_contact->org_id]]></oql_view>
						</scope>
						<scope id="all">
							<oql_view><![CDATA[SELECT Contact]]></oql_view>
							<allowed_profiles>
								<allowed_profile id="Administrator"/>
							</allowed_profiles>
						</scope>
					</scopes>
					<lists>
						<list id="default">
							<items>
								<item id="status">
									<rank>10</rank>
								</item>
								<item id="org_id">
									<rank>20</rank>
								</item>
								<item id="function">
									<rank>50</rank>
								</item>
							</items>
						</list>
					</lists>
				</class>
			</classes>
		</module_design>
	</module_designs>
</itop_design>
